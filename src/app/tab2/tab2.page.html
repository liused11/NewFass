<ion-header class="ion-no-border">
  <ion-toolbar class="bg-white border-b border-gray-200 shadow-none" style="--background: white;">
    <ion-title>การจองของฉัน</ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-icon name="search-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Filter Dropdowns Row -->
  <div class="flex gap-3 px-4 py-2.5 bg-white">
    <!-- Date/Month Filter -->
    <div
      class="flex-1 flex items-center justify-between border border-gray-300 rounded-lg h-10 px-3 text-sm text-gray-500 bg-white">
      <ion-icon name="calendar-outline" class="text-base text-gray-400 mr-2"></ion-icon>
      <ion-select interface="popover" [(ngModel)]="selectedMonth" (ionChange)="filterChanged()"
        class="flex-1 w-full text-gray-900 text-sm p-0 min-h-0">
        <ion-select-option *ngFor="let opt of monthOptions" [value]="opt.value">
          {{ opt.label }}
        </ion-select-option>
      </ion-select>
      <ion-icon name="chevron-down-outline" class="text-sm text-gray-300 pointer-events-none"></ion-icon>
    </div>

    <!-- Category Filter -->
    <div
      class="flex-1 flex items-center justify-between border border-gray-300 rounded-lg h-10 px-3 text-sm text-gray-500 bg-white">
      <ion-icon name="layers-outline" class="text-base text-gray-400 mr-2"></ion-icon>
      <ion-select interface="popover" [(ngModel)]="selectedCategory" (ionChange)="filterChanged()"
        class="flex-1 w-full text-gray-900 text-sm p-0 min-h-0">
        <ion-select-option *ngFor="let opt of categoryOptions" [value]="opt.value">
          {{ opt.label }}
        </ion-select-option>
      </ion-select>
      <ion-icon name="chevron-down-outline" class="text-sm text-gray-300 pointer-events-none"></ion-icon>
    </div>
  </div>

  <!-- Status Tabs -->
  <ion-toolbar class="bg-white pb-2" style="--background: white;">
    <ion-segment [(ngModel)]="selectedStatusSegment" (ionChange)="segmentChanged($event)" mode="md"
      class="bg-transparent">
      <ion-segment-button value="in_progress"
        class="min-w-0 flex-1 [--indicator-color:var(--ion-color-primary)] [--color:#999] [--color-checked:var(--ion-color-primary)]">
        <ion-label class="text-sm font-medium">กำลังดำเนินการ</ion-label>
      </ion-segment-button>
      <ion-segment-button value="completed"
        class="min-w-0 flex-1 [--indicator-color:var(--ion-color-primary)] [--color:#999] [--color-checked:var(--ion-color-primary)]">
        <ion-label class="text-sm font-medium">เสร็จสิ้น</ion-label>
      </ion-segment-button>
      <ion-segment-button value="cancelled"
        class="min-w-0 flex-1 [--indicator-color:var(--ion-color-primary)] [--color:#999] [--color-checked:var(--ion-color-primary)]">
        <ion-label class="text-sm font-medium">ยกเลิก/ล้มเหลว</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-[#f7f8fa]">
  <div class="p-4 pb-10">

    <!-- 1. Latest Bookings -->
    <div class="mb-6">
      <div class="mb-3">
        <div class="text-sm font-semibold text-black m-0">รายการล่าสุด</div>
      </div>
      <div *ngIf="latestBookings.length === 0" class="text-center text-gray-400 text-sm p-2.5">
        - ไม่พบรายการ -
      </div>
      <div *ngFor="let item of latestBookings"
        class="bg-white rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08)] mb-4 overflow-hidden border border-gray-100">
        <div class="p-4 pb-3">
          <!-- Top Row -->
          <div class="flex justify-between items-start mb-4">
            <!-- TL: Status -->
            <div class="flex items-center gap-1.5 text-[15px] font-bold" [ngClass]="getStatusClass(item)">
              <ion-icon name="car-sport" class="text-lg"></ion-icon> {{ item.statusLabel }}
            </div>
            <!-- TR: Time -->
            <div class="text-right">
              <div class="text-[15px] font-semibold text-[var(--ion-color-primary)] mb-0.5">{{ item.bookingTime |
                date:'EEE d MMM' }}</div>
              <div class="text-[13px] text-gray-800 whitespace-pre-line">{{ item.bookingTime | date:'HH:mm' }} - {{
                item.endTime | date:'HH:mm' }} น.</div>
            </div>
          </div>

          <!-- Bottom Row -->
          <div class="flex justify-between items-end mb-0">
            <!-- BL: Location -->
            <div>
              <div
                class="text-xs text-gray-500 mb-0.5 flex items-center gap-1 before:content-[''] before:inline-block before:w-3 before:h-3 before:bg-[url('data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20512%20512%22%3E%3Cpath%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22%20d=%22M256%2048c-79.5%200-144%2061.39-144%20137%200%2087%2096%20224.87%20131.25%20272.49a15.77%2015.77%200%200025.5%200C304%20409.89%20400%20272.07%20400%20185c0-75.61-64.5-137-144-137z%22/%3E%3Ccircle%20cx=%22256%22%20cy=%22192%22%20r=%2248%22%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22/%3E%3C/svg%3E')] before:bg-contain before:bg-no-repeat">
                {{ item.placeName }}</div>
              <div class="text-xl text-gray-800 font-normal">
                <span class="font-normal">{{ item.locationDetails.split('|')[0] }} | {{
                  item.locationDetails.split('|')[1] }}</span>
                <span class="font-normal"> | {{ item.locationDetails.split('|')[2] }}</span>
              </div>
            </div>
            <!-- BR: Car / User -->
            <div class="text-right">
              <div class="text-[10px] text-gray-500 uppercase mb-0.5 flex items-center justify-end gap-1"><ion-icon
                  name="car"></ion-icon> {{ item.carBrand }}</div>
              <div class="text-[11px] text-gray-500">{{ item.licensePlate }}</div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="px-4 py-2.5 flex justify-between items-center bg-[var(--ion-color-primary)] text-white">
          <div class="flex items-center gap-2 text-white text-lg font-bold">
            <ion-icon name="wallet-outline"></ion-icon> ฿{{ item.price }}
            <span *ngIf="item.discountBadge"
              class="bg-white text-[var(--ion-color-primary)] text-[10px] px-1.5 py-0.5 rounded-[10px] font-semibold">{{
              item.discountBadge }}</span>
          </div>
          <div class="text-white text-[13px] font-medium cursor-pointer">
            ชำระเงินตอนนี้ ->
          </div>
        </div>
      </div>
    </div>

    <!-- 2. Flat 24h Bookings -->
    <div class="mb-6">
      <div class="mb-3">
        <div class="text-sm font-semibold text-black m-0">รายการเหมาจ่าย 24 ชั่วโมง</div>
      </div>
      <div *ngIf="flat24Bookings.length === 0" class="text-center text-gray-400 text-sm p-2.5">
        - ไม่พบรายการ -
      </div>
      <div *ngFor="let item of flat24Bookings"
        class="bg-white rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08)] mb-4 overflow-hidden border border-gray-100">
        <div class="p-4 pb-3">
          <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-1.5 text-[15px] font-bold" [ngClass]="getStatusClass(item)">
              <ion-icon name="car-sport" class="text-lg"></ion-icon> {{ item.statusLabel }}
            </div>
            <div class="text-right">
              <div class="text-[15px] font-semibold text-[var(--ion-color-primary)] mb-0.5">{{ item.bookingTime |
                date:'EEE d MMM' }}</div>
              <div class="text-[13px] text-gray-800 whitespace-pre-line">{{ item.periodLabel }}</div>
            </div>
          </div>
          <div class="flex justify-between items-end mb-0">
            <div>
              <div
                class="text-xs text-gray-500 mb-0.5 flex items-center gap-1 before:content-[''] before:inline-block before:w-3 before:h-3 before:bg-[url('data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20512%20512%22%3E%3Cpath%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22%20d=%22M256%2048c-79.5%200-144%2061.39-144%20137%200%2087%2096%20224.87%20131.25%20272.49a15.77%2015.77%200%200025.5%200C304%20409.89%20400%20272.07%20400%20185c0-75.61-64.5-137-144-137z%22/%3E%3Ccircle%20cx=%22256%22%20cy=%22192%22%20r=%2248%22%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22/%3E%3C/svg%3E')] before:bg-contain before:bg-no-repeat">
                {{ item.placeName }}</div>
              <div class="text-xl text-gray-800 font-normal">
                <span class="font-normal">{{ item.locationDetails.split('|')[0] }} | {{
                  item.locationDetails.split('|')[1] }}</span>
                <span class="font-normal"> | {{ item.locationDetails.split('|')[2] }}</span>
              </div>
            </div>
            <div class="text-right">
              <div class="text-[10px] text-gray-500 uppercase mb-0.5 flex items-center justify-end gap-1"><ion-icon
                  name="car"></ion-icon> {{ item.carBrand }}</div>
              <div class="text-[11px] text-gray-500">{{ item.licensePlate }}</div>
            </div>
          </div>
        </div>
        <div class="px-4 py-2.5 flex justify-between items-center bg-[var(--ion-color-primary)] text-white">
          <div class="flex items-center gap-2 text-white text-lg font-bold">
            <ion-icon name="wallet-outline"></ion-icon> ฿{{ item.price }}
          </div>
          <div class="text-white text-[13px] font-medium cursor-pointer">
            ชำระเงินตอนนี้ ->
          </div>
        </div>
      </div>
    </div>

    <!-- 3. Monthly Bookings -->
    <div class="mb-6">
      <div class="mb-3">
        <div class="text-sm font-semibold text-black m-0">รายการสมาชิกรายเดือน</div>
      </div>
      <div *ngIf="monthlyBookings.length === 0" class="text-center text-gray-400 text-sm p-2.5">
        - ไม่พบรายการ -
      </div>
      <div *ngFor="let item of monthlyBookings"
        class="bg-white rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08)] mb-4 overflow-hidden border border-gray-100 border-[2px] border-[var(--ion-color-primary)]">
        <div class="p-4 pb-3">
          <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-1.5 text-[15px] font-bold text-[var(--ion-color-primary)]">
              <ion-icon name="car-sport" class="text-lg"></ion-icon> {{ item.statusLabel }}
            </div>
            <div class="text-right">
              <div class="text-[15px] font-semibold text-[var(--ion-color-primary)] mb-0.5">{{ item.periodLabel }}</div>
              <div class="text-[13px] text-gray-800 whitespace-pre-line">{{ item.bookingTime | date:'HH:mm' }} - {{
                item.endTime | date:'HH:mm' }} น.</div>
            </div>
          </div>
          <div class="flex justify-between items-end mb-0">
            <div>
              <div
                class="text-xs text-gray-500 mb-0.5 flex items-center gap-1 before:content-[''] before:inline-block before:w-3 before:h-3 before:bg-[url('data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20512%20512%22%3E%3Cpath%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22%20d=%22M256%2048c-79.5%200-144%2061.39-144%20137%200%2087%2096%20224.87%20131.25%20272.49a15.77%2015.77%200%200025.5%200C304%20409.89%20400%20272.07%20400%20185c0-75.61-64.5-137-144-137z%22/%3E%3Ccircle%20cx=%22256%22%20cy=%22192%22%20r=%2248%22%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22/%3E%3C/svg%3E')] before:bg-contain before:bg-no-repeat">
                {{ item.placeName }}</div>
              <div class="text-xl text-gray-800 font-normal">
                <span class="font-normal">{{ item.locationDetails }}</span>
              </div>
            </div>
            <div class="text-right">
              <div class="text-[10px] text-gray-500 uppercase mb-0.5 flex items-center justify-end gap-1"><ion-icon
                  name="car"></ion-icon> {{ item.carBrand }}</div>
              <div class="text-[11px] text-gray-500">{{ item.licensePlate }}</div>
            </div>
          </div>
        </div>
        <div class="px-4 py-2.5 flex justify-between items-center bg-white border-t border-gray-100">
          <div class="flex items-center gap-2 text-[var(--ion-color-primary)] text-[22px] font-bold">
            <ion-icon name="wallet-outline"></ion-icon> ฿{{ item.price | number }}
          </div>
          <div class="text-[var(--ion-color-primary)] text-xs underline cursor-pointer">
            ชำระเงินสำเร็จแล้ว
          </div>
        </div>
      </div>
    </div>

    <!-- 4. Monthly Night Bookings -->
    <div class="mb-6">
      <div class="mb-3">
        <div class="text-sm font-semibold text-black m-0">รายการสมาชิกรายเดือนเฉพาะกลางคืน(18:00-08:00 น.)</div>
      </div>
      <div *ngIf="nightlyBookings.length === 0" class="text-center text-gray-400 text-sm p-2.5">
        - ไม่พบรายการ -
      </div>
      <div *ngFor="let item of nightlyBookings"
        class="bg-white rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08)] mb-4 overflow-hidden border border-gray-100 border-[2px] border-[var(--ion-color-primary)]">
        <div class="p-4 pb-3">
          <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-1.5 text-[15px] font-bold text-[var(--ion-color-primary)]">
              <ion-icon name="car-sport" class="text-lg"></ion-icon> {{ item.statusLabel }}
            </div>
            <div class="text-right">
              <div class="text-[15px] font-semibold text-[var(--ion-color-primary)] mb-0.5">{{ item.periodLabel }}</div>
              <div class="text-[13px] text-gray-800 whitespace-pre-line">{{ item.timeDetailLabel ? item.timeDetailLabel
                : (item.bookingTime | date:'HH:mm')
                + ' - ' + (item.endTime | date:'HH:mm') + ' น.' }}</div>
            </div>
          </div>
          <div class="flex justify-between items-end mb-0">
            <div>
              <div
                class="text-xs text-gray-500 mb-0.5 flex items-center gap-1 before:content-[''] before:inline-block before:w-3 before:h-3 before:bg-[url('data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20512%20512%22%3E%3Cpath%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22%20d=%22M256%2048c-79.5%200-144%2061.39-144%20137%200%2087%2096%20224.87%20131.25%20272.49a15.77%2015.77%200%200025.5%200C304%20409.89%20400%20272.07%20400%20185c0-75.61-64.5-137-144-137z%22/%3E%3Ccircle%20cx=%22256%22%20cy=%22192%22%20r=%2248%22%20fill=%22none%22%20stroke=%22%23666%22%20stroke-linecap=%22round%22%20stroke-linejoin=%22round%22%20stroke-width=%2232%22/%3E%3C/svg%3E')] before:bg-contain before:bg-no-repeat">
                {{ item.placeName }}</div>
              <div class="text-xl text-gray-800 font-normal">
                <span class="font-normal">{{ item.locationDetails.split('|')[0] }} | {{
                  item.locationDetails.split('|')[1] }}</span>
                <span class="font-normal"> | {{ item.locationDetails.split('|')[2] }}</span>
              </div>
            </div>
            <div class="text-right">
              <div class="text-[10px] text-gray-500 uppercase mb-0.5 flex items-center justify-end gap-1"><ion-icon
                  name="car"></ion-icon> {{ item.carBrand }}</div>
              <div class="text-[11px] text-gray-500">{{ item.licensePlate }}</div>
            </div>
          </div>
        </div>
        <div class="px-4 py-2.5 flex justify-between items-center bg-white border-t border-gray-100">
          <div class="flex items-center gap-2 text-[var(--ion-color-primary)] text-[22px] font-bold">
            <ion-icon name="wallet-outline"></ion-icon> ฿{{ item.price | number }}
          </div>
          <div class="text-[var(--ion-color-primary)] text-xs underline cursor-pointer">
            ชำระเงินสำเร็จแล้ว
          </div>
        </div>
      </div>
    </div>

  </div>
</ion-content>